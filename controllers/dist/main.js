function e(e,t,n,r,i,o,s){try{var c=e[o](s),a=c.value}catch(e){return void n(e)}c.done?t(a):Promise.resolve(a).then(r,i)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=o(e);if(t){var i=o(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}function u(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h=function(){function e(e,t){this.eventTarget=e,this.eventName=t,this.unorderedBindings=new Set}return e.prototype.connect=function(){this.eventTarget.addEventListener(this.eventName,this,!1)},e.prototype.disconnect=function(){this.eventTarget.removeEventListener(this.eventName,this,!1)},e.prototype.bindingConnected=function(e){this.unorderedBindings.add(e)},e.prototype.bindingDisconnected=function(e){this.unorderedBindings.delete(e)},e.prototype.handleEvent=function(e){for(var t=function(e){if("immediatePropagationStopped"in e)return e;var t=e.stopImmediatePropagation;return Object.assign(e,{immediatePropagationStopped:!1,stopImmediatePropagation:function(){this.immediatePropagationStopped=!0,t.call(this)}})}(e),n=0,r=this.bindings;n<r.length;n++){var i=r[n];if(t.immediatePropagationStopped)break;i.handleEvent(t)}},Object.defineProperty(e.prototype,"bindings",{get:function(){return Array.from(this.unorderedBindings).sort((function(e,t){var n=e.index,r=t.index;return n<r?-1:n>r?1:0}))},enumerable:!0,configurable:!0}),e}();var f=function(){function e(e){this.application=e,this.eventListenerMaps=new Map,this.started=!1}return e.prototype.start=function(){this.started||(this.started=!0,this.eventListeners.forEach((function(e){return e.connect()})))},e.prototype.stop=function(){this.started&&(this.started=!1,this.eventListeners.forEach((function(e){return e.disconnect()})))},Object.defineProperty(e.prototype,"eventListeners",{get:function(){return Array.from(this.eventListenerMaps.values()).reduce((function(e,t){return e.concat(Array.from(t.values()))}),[])},enumerable:!0,configurable:!0}),e.prototype.bindingConnected=function(e){this.fetchEventListenerForBinding(e).bindingConnected(e)},e.prototype.bindingDisconnected=function(e){this.fetchEventListenerForBinding(e).bindingDisconnected(e)},e.prototype.handleError=function(e,t,n){void 0===n&&(n={}),this.application.handleError(e,"Error "+t,n)},e.prototype.fetchEventListenerForBinding=function(e){var t=e.eventTarget,n=e.eventName;return this.fetchEventListener(t,n)},e.prototype.fetchEventListener=function(e,t){var n=this.fetchEventListenerMapForEventTarget(e),r=n.get(t);return r||(r=this.createEventListener(e,t),n.set(t,r)),r},e.prototype.createEventListener=function(e,t){var n=new h(e,t);return this.started&&n.connect(),n},e.prototype.fetchEventListenerMapForEventTarget=function(e){var t=this.eventListenerMaps.get(e);return t||(t=new Map,this.eventListenerMaps.set(e,t)),t},e}(),p=/^((.+?)(@(window|document))?->)?(.+?)(#(.+))?$/;function d(e){return"window"==e?window:"document"==e?document:void 0}var m=function(){function e(e,t,n){this.element=e,this.index=t,this.eventTarget=n.eventTarget||e,this.eventName=n.eventName||function(e){var t=e.tagName.toLowerCase();if(t in y)return y[t](e)}(e)||g("missing event name"),this.identifier=n.identifier||g("missing identifier"),this.methodName=n.methodName||g("missing method name")}return e.forToken=function(e){return new this(e.element,e.index,(t=e.content,{eventTarget:d((n=t.trim().match(p)||[])[4]),eventName:n[2],identifier:n[5],methodName:n[7]}));var t,n},e.prototype.toString=function(){var e=this.eventTargetName?"@"+this.eventTargetName:"";return""+this.eventName+e+"->"+this.identifier+"#"+this.methodName},Object.defineProperty(e.prototype,"eventTargetName",{get:function(){return(e=this.eventTarget)==window?"window":e==document?"document":void 0;var e},enumerable:!0,configurable:!0}),e}(),y={a:function(e){return"click"},button:function(e){return"click"},form:function(e){return"submit"},input:function(e){return"submit"==e.getAttribute("type")?"click":"change"},select:function(e){return"change"},textarea:function(e){return"change"}};function g(e){throw new Error(e)}var v=function(){function e(e,t){this.context=e,this.action=t}return Object.defineProperty(e.prototype,"index",{get:function(){return this.action.index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventTarget",{get:function(){return this.action.eventTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this.context.identifier},enumerable:!0,configurable:!0}),e.prototype.handleEvent=function(e){this.willBeInvokedByEvent(e)&&this.invokeWithEvent(e)},Object.defineProperty(e.prototype,"eventName",{get:function(){return this.action.eventName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){var e=this.controller[this.methodName];if("function"==typeof e)return e;throw new Error('Action "'+this.action+'" references undefined method "'+this.methodName+'"')},enumerable:!0,configurable:!0}),e.prototype.invokeWithEvent=function(e){try{this.method.call(this.controller,e)}catch(n){var t={identifier:this.identifier,controller:this.controller,element:this.element,index:this.index,event:e};this.context.handleError(n,'invoking action "'+this.action+'"',t)}},e.prototype.willBeInvokedByEvent=function(e){var t=e.target;return this.element===t||(!(t instanceof Element&&this.element.contains(t))||this.scope.containsElement(t))},Object.defineProperty(e.prototype,"controller",{get:function(){return this.context.controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"methodName",{get:function(){return this.action.methodName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scope",{get:function(){return this.context.scope},enumerable:!0,configurable:!0}),e}(),b=function(){function e(e,t){var n=this;this.element=e,this.started=!1,this.delegate=t,this.elements=new Set,this.mutationObserver=new MutationObserver((function(e){return n.processMutations(e)}))}return e.prototype.start=function(){this.started||(this.started=!0,this.mutationObserver.observe(this.element,{attributes:!0,childList:!0,subtree:!0}),this.refresh())},e.prototype.stop=function(){this.started&&(this.mutationObserver.takeRecords(),this.mutationObserver.disconnect(),this.started=!1)},e.prototype.refresh=function(){if(this.started){for(var e=new Set(this.matchElementsInTree()),t=0,n=Array.from(this.elements);t<n.length;t++){var r=n[t];e.has(r)||this.removeElement(r)}for(var i=0,o=Array.from(e);i<o.length;i++){r=o[i];this.addElement(r)}}},e.prototype.processMutations=function(e){if(this.started)for(var t=0,n=e;t<n.length;t++){var r=n[t];this.processMutation(r)}},e.prototype.processMutation=function(e){"attributes"==e.type?this.processAttributeChange(e.target,e.attributeName):"childList"==e.type&&(this.processRemovedNodes(e.removedNodes),this.processAddedNodes(e.addedNodes))},e.prototype.processAttributeChange=function(e,t){var n=e;this.elements.has(n)?this.delegate.elementAttributeChanged&&this.matchElement(n)?this.delegate.elementAttributeChanged(n,t):this.removeElement(n):this.matchElement(n)&&this.addElement(n)},e.prototype.processRemovedNodes=function(e){for(var t=0,n=Array.from(e);t<n.length;t++){var r=n[t],i=this.elementFromNode(r);i&&this.processTree(i,this.removeElement)}},e.prototype.processAddedNodes=function(e){for(var t=0,n=Array.from(e);t<n.length;t++){var r=n[t],i=this.elementFromNode(r);i&&this.elementIsActive(i)&&this.processTree(i,this.addElement)}},e.prototype.matchElement=function(e){return this.delegate.matchElement(e)},e.prototype.matchElementsInTree=function(e){return void 0===e&&(e=this.element),this.delegate.matchElementsInTree(e)},e.prototype.processTree=function(e,t){for(var n=0,r=this.matchElementsInTree(e);n<r.length;n++){var i=r[n];t.call(this,i)}},e.prototype.elementFromNode=function(e){if(e.nodeType==Node.ELEMENT_NODE)return e},e.prototype.elementIsActive=function(e){return e.isConnected==this.element.isConnected&&this.element.contains(e)},e.prototype.addElement=function(e){this.elements.has(e)||this.elementIsActive(e)&&(this.elements.add(e),this.delegate.elementMatched&&this.delegate.elementMatched(e))},e.prototype.removeElement=function(e){this.elements.has(e)&&(this.elements.delete(e),this.delegate.elementUnmatched&&this.delegate.elementUnmatched(e))},e}(),E=function(){function e(e,t,n){this.attributeName=t,this.delegate=n,this.elementObserver=new b(e,this)}return Object.defineProperty(e.prototype,"element",{get:function(){return this.elementObserver.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selector",{get:function(){return"["+this.attributeName+"]"},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.elementObserver.start()},e.prototype.stop=function(){this.elementObserver.stop()},e.prototype.refresh=function(){this.elementObserver.refresh()},Object.defineProperty(e.prototype,"started",{get:function(){return this.elementObserver.started},enumerable:!0,configurable:!0}),e.prototype.matchElement=function(e){return e.hasAttribute(this.attributeName)},e.prototype.matchElementsInTree=function(e){var t=this.matchElement(e)?[e]:[],n=Array.from(e.querySelectorAll(this.selector));return t.concat(n)},e.prototype.elementMatched=function(e){this.delegate.elementMatchedAttribute&&this.delegate.elementMatchedAttribute(e,this.attributeName)},e.prototype.elementUnmatched=function(e){this.delegate.elementUnmatchedAttribute&&this.delegate.elementUnmatchedAttribute(e,this.attributeName)},e.prototype.elementAttributeChanged=function(e,t){this.delegate.elementAttributeValueChanged&&this.attributeName==t&&this.delegate.elementAttributeValueChanged(e,t)},e}();function k(e,t,n){A(e,t).add(n)}function w(e,t,n){A(e,t).delete(n),function(e,t){var n=e.get(t);null!=n&&0==n.size&&e.delete(t)}(e,t)}function A(e,t){var n=e.get(t);return n||(n=new Set,e.set(t,n)),n}var O,C=function(){function e(){this.valuesByKey=new Map}return Object.defineProperty(e.prototype,"values",{get:function(){return Array.from(this.valuesByKey.values()).reduce((function(e,t){return e.concat(Array.from(t))}),[])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return Array.from(this.valuesByKey.values()).reduce((function(e,t){return e+t.size}),0)},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){k(this.valuesByKey,e,t)},e.prototype.delete=function(e,t){w(this.valuesByKey,e,t)},e.prototype.has=function(e,t){var n=this.valuesByKey.get(e);return null!=n&&n.has(t)},e.prototype.hasKey=function(e){return this.valuesByKey.has(e)},e.prototype.hasValue=function(e){return Array.from(this.valuesByKey.values()).some((function(t){return t.has(e)}))},e.prototype.getValuesForKey=function(e){var t=this.valuesByKey.get(e);return t?Array.from(t):[]},e.prototype.getKeysForValue=function(e){return Array.from(this.valuesByKey).filter((function(t){t[0];return t[1].has(e)})).map((function(e){var t=e[0];e[1];return t}))},e}(),T=(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}O(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),P=(function(e){function t(){var t=e.call(this)||this;return t.keysByValue=new Map,t}T(t,e),Object.defineProperty(t.prototype,"values",{get:function(){return Array.from(this.keysByValue.keys())},enumerable:!0,configurable:!0}),t.prototype.add=function(t,n){e.prototype.add.call(this,t,n),k(this.keysByValue,n,t)},t.prototype.delete=function(t,n){e.prototype.delete.call(this,t,n),w(this.keysByValue,n,t)},t.prototype.hasValue=function(e){return this.keysByValue.has(e)},t.prototype.getKeysForValue=function(e){var t=this.keysByValue.get(e);return t?Array.from(t):[]}}(C),function(){function e(e,t,n){this.attributeObserver=new E(e,t,this),this.delegate=n,this.tokensByElement=new C}return Object.defineProperty(e.prototype,"started",{get:function(){return this.attributeObserver.started},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.attributeObserver.start()},e.prototype.stop=function(){this.attributeObserver.stop()},e.prototype.refresh=function(){this.attributeObserver.refresh()},Object.defineProperty(e.prototype,"element",{get:function(){return this.attributeObserver.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributeName",{get:function(){return this.attributeObserver.attributeName},enumerable:!0,configurable:!0}),e.prototype.elementMatchedAttribute=function(e){this.tokensMatched(this.readTokensForElement(e))},e.prototype.elementAttributeValueChanged=function(e){var t=this.refreshTokensForElement(e),n=t[0],r=t[1];this.tokensUnmatched(n),this.tokensMatched(r)},e.prototype.elementUnmatchedAttribute=function(e){this.tokensUnmatched(this.tokensByElement.getValuesForKey(e))},e.prototype.tokensMatched=function(e){var t=this;e.forEach((function(e){return t.tokenMatched(e)}))},e.prototype.tokensUnmatched=function(e){var t=this;e.forEach((function(e){return t.tokenUnmatched(e)}))},e.prototype.tokenMatched=function(e){this.delegate.tokenMatched(e),this.tokensByElement.add(e.element,e)},e.prototype.tokenUnmatched=function(e){this.delegate.tokenUnmatched(e),this.tokensByElement.delete(e.element,e)},e.prototype.refreshTokensForElement=function(e){var t,n,r,i=this.tokensByElement.getValuesForKey(e),o=this.readTokensForElement(e),s=(t=i,n=o,r=Math.max(t.length,n.length),Array.from({length:r},(function(e,r){return[t[r],n[r]]}))).findIndex((function(e){return!function(e,t){return e&&t&&e.index==t.index&&e.content==t.content}(e[0],e[1])}));return-1==s?[[],[]]:[i.slice(s),o.slice(s)]},e.prototype.readTokensForElement=function(e){var t=this.attributeName;return function(e,t,n){return e.trim().split(/\s+/).filter((function(e){return e.length})).map((function(e,r){return{element:t,attributeName:n,content:e,index:r}}))}(e.getAttribute(t)||"",e,t)},e}());var x=function(){function e(e,t,n){this.tokenListObserver=new P(e,t,this),this.delegate=n,this.parseResultsByToken=new WeakMap,this.valuesByTokenByElement=new WeakMap}return Object.defineProperty(e.prototype,"started",{get:function(){return this.tokenListObserver.started},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.tokenListObserver.start()},e.prototype.stop=function(){this.tokenListObserver.stop()},e.prototype.refresh=function(){this.tokenListObserver.refresh()},Object.defineProperty(e.prototype,"element",{get:function(){return this.tokenListObserver.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributeName",{get:function(){return this.tokenListObserver.attributeName},enumerable:!0,configurable:!0}),e.prototype.tokenMatched=function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).set(e,n),this.delegate.elementMatchedValue(t,n))},e.prototype.tokenUnmatched=function(e){var t=e.element,n=this.fetchParseResultForToken(e).value;n&&(this.fetchValuesByTokenForElement(t).delete(e),this.delegate.elementUnmatchedValue(t,n))},e.prototype.fetchParseResultForToken=function(e){var t=this.parseResultsByToken.get(e);return t||(t=this.parseToken(e),this.parseResultsByToken.set(e,t)),t},e.prototype.fetchValuesByTokenForElement=function(e){var t=this.valuesByTokenByElement.get(e);return t||(t=new Map,this.valuesByTokenByElement.set(e,t)),t},e.prototype.parseToken=function(e){try{return{value:this.delegate.parseValueForToken(e)}}catch(e){return{error:e}}},e}(),j=function(){function e(e,t){this.context=e,this.delegate=t,this.bindingsByAction=new Map}return e.prototype.start=function(){this.valueListObserver||(this.valueListObserver=new x(this.element,this.actionAttribute,this),this.valueListObserver.start())},e.prototype.stop=function(){this.valueListObserver&&(this.valueListObserver.stop(),delete this.valueListObserver,this.disconnectAllActions())},Object.defineProperty(e.prototype,"element",{get:function(){return this.context.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this.context.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionAttribute",{get:function(){return this.schema.actionAttribute},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this.context.schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bindings",{get:function(){return Array.from(this.bindingsByAction.values())},enumerable:!0,configurable:!0}),e.prototype.connectAction=function(e){var t=new v(this.context,e);this.bindingsByAction.set(e,t),this.delegate.bindingConnected(t)},e.prototype.disconnectAction=function(e){var t=this.bindingsByAction.get(e);t&&(this.bindingsByAction.delete(e),this.delegate.bindingDisconnected(t))},e.prototype.disconnectAllActions=function(){var e=this;this.bindings.forEach((function(t){return e.delegate.bindingDisconnected(t)})),this.bindingsByAction.clear()},e.prototype.parseValueForToken=function(e){var t=m.forToken(e);if(t.identifier==this.identifier)return t},e.prototype.elementMatchedValue=function(e,t){this.connectAction(t)},e.prototype.elementUnmatchedValue=function(e,t){this.disconnectAction(t)},e}(),B=function(){function e(e,t){this.module=e,this.scope=t,this.controller=new e.controllerConstructor(this),this.bindingObserver=new j(this,this.dispatcher);try{this.controller.initialize()}catch(e){this.handleError(e,"initializing controller")}}return e.prototype.connect=function(){this.bindingObserver.start();try{this.controller.connect()}catch(e){this.handleError(e,"connecting controller")}},e.prototype.disconnect=function(){try{this.controller.disconnect()}catch(e){this.handleError(e,"disconnecting controller")}this.bindingObserver.stop()},Object.defineProperty(e.prototype,"application",{get:function(){return this.module.application},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this.module.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this.application.schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dispatcher",{get:function(){return this.application.dispatcher},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentElement",{get:function(){return this.element.parentElement},enumerable:!0,configurable:!0}),e.prototype.handleError=function(e,t,n){void 0===n&&(n={});var r=this.identifier,i=this.controller,o=this.element;n=Object.assign({identifier:r,controller:i,element:o},n),this.application.handleError(e,"Error "+t,n)},e}(),N=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function L(e){var t=M(e);return t.bless(),t}var M=function(){function e(e){function t(){var n=this&&this instanceof t?this.constructor:void 0;return Reflect.construct(e,arguments,n)}return t.prototype=Object.create(e.prototype,{constructor:{value:t}}),Reflect.setPrototypeOf(t,e),t}try{return(t=e((function(){this.a.call(this)}))).prototype.a=function(){},new t,e}catch(e){return function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return N(t,e),t}(e)}}var t}(),F=function(){function e(e,t){this.application=e,this.definition=function(e){return{identifier:e.identifier,controllerConstructor:L(e.controllerConstructor)}}(t),this.contextsByScope=new WeakMap,this.connectedContexts=new Set}return Object.defineProperty(e.prototype,"identifier",{get:function(){return this.definition.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controllerConstructor",{get:function(){return this.definition.controllerConstructor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contexts",{get:function(){return Array.from(this.connectedContexts)},enumerable:!0,configurable:!0}),e.prototype.connectContextForScope=function(e){var t=this.fetchContextForScope(e);this.connectedContexts.add(t),t.connect()},e.prototype.disconnectContextForScope=function(e){var t=this.contextsByScope.get(e);t&&(this.connectedContexts.delete(t),t.disconnect())},e.prototype.fetchContextForScope=function(e){var t=this.contextsByScope.get(e);return t||(t=new B(this,e),this.contextsByScope.set(e,t)),t},e}(),S=function(){function e(e){this.scope=e}return Object.defineProperty(e.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this.scope.identifier},enumerable:!0,configurable:!0}),e.prototype.get=function(e){return e=this.getFormattedKey(e),this.element.getAttribute(e)},e.prototype.set=function(e,t){return e=this.getFormattedKey(e),this.element.setAttribute(e,t),this.get(e)},e.prototype.has=function(e){return e=this.getFormattedKey(e),this.element.hasAttribute(e)},e.prototype.delete=function(e){return!!this.has(e)&&(e=this.getFormattedKey(e),this.element.removeAttribute(e),!0)},e.prototype.getFormattedKey=function(e){return"data-"+this.identifier+"-"+e.replace(/([A-Z])/g,(function(e,t){return"-"+t.toLowerCase()}))},e}();function I(e,t){return"["+e+'~="'+t+'"]'}var V=function(){function e(e){this.scope=e}return Object.defineProperty(e.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this.scope.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this.scope.schema},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return null!=this.find(e)},e.prototype.find=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getSelectorForTargetNames(e);return this.scope.findElement(n)},e.prototype.findAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.getSelectorForTargetNames(e);return this.scope.findAllElements(n)},e.prototype.getSelectorForTargetNames=function(e){var t=this;return e.map((function(e){return t.getSelectorForTargetName(e)})).join(", ")},e.prototype.getSelectorForTargetName=function(e){var t=this.identifier+"."+e;return I(this.schema.targetAttribute,t)},e}(),_=function(){function e(e,t,n){this.schema=e,this.identifier=t,this.element=n,this.targets=new V(this),this.data=new S(this)}return e.prototype.findElement=function(e){return this.findAllElements(e)[0]},e.prototype.findAllElements=function(e){var t=this.element.matches(e)?[this.element]:[],n=this.filterElements(Array.from(this.element.querySelectorAll(e)));return t.concat(n)},e.prototype.filterElements=function(e){var t=this;return e.filter((function(e){return t.containsElement(e)}))},e.prototype.containsElement=function(e){return e.closest(this.controllerSelector)===this.element},Object.defineProperty(e.prototype,"controllerSelector",{get:function(){return I(this.schema.controllerAttribute,this.identifier)},enumerable:!0,configurable:!0}),e}(),R=function(){function e(e,t,n){this.element=e,this.schema=t,this.delegate=n,this.valueListObserver=new x(this.element,this.controllerAttribute,this),this.scopesByIdentifierByElement=new WeakMap,this.scopeReferenceCounts=new WeakMap}return e.prototype.start=function(){this.valueListObserver.start()},e.prototype.stop=function(){this.valueListObserver.stop()},Object.defineProperty(e.prototype,"controllerAttribute",{get:function(){return this.schema.controllerAttribute},enumerable:!0,configurable:!0}),e.prototype.parseValueForToken=function(e){var t=e.element,n=e.content,r=this.fetchScopesByIdentifierForElement(t),i=r.get(n);return i||(i=new _(this.schema,n,t),r.set(n,i)),i},e.prototype.elementMatchedValue=function(e,t){var n=(this.scopeReferenceCounts.get(t)||0)+1;this.scopeReferenceCounts.set(t,n),1==n&&this.delegate.scopeConnected(t)},e.prototype.elementUnmatchedValue=function(e,t){var n=this.scopeReferenceCounts.get(t);n&&(this.scopeReferenceCounts.set(t,n-1),1==n&&this.delegate.scopeDisconnected(t))},e.prototype.fetchScopesByIdentifierForElement=function(e){var t=this.scopesByIdentifierByElement.get(e);return t||(t=new Map,this.scopesByIdentifierByElement.set(e,t)),t},e}(),D=function(){function e(e){this.application=e,this.scopeObserver=new R(this.element,this.schema,this),this.scopesByIdentifier=new C,this.modulesByIdentifier=new Map}return Object.defineProperty(e.prototype,"element",{get:function(){return this.application.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this.application.schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controllerAttribute",{get:function(){return this.schema.controllerAttribute},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modules",{get:function(){return Array.from(this.modulesByIdentifier.values())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contexts",{get:function(){return this.modules.reduce((function(e,t){return e.concat(t.contexts)}),[])},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.scopeObserver.start()},e.prototype.stop=function(){this.scopeObserver.stop()},e.prototype.loadDefinition=function(e){this.unloadIdentifier(e.identifier);var t=new F(this.application,e);this.connectModule(t)},e.prototype.unloadIdentifier=function(e){var t=this.modulesByIdentifier.get(e);t&&this.disconnectModule(t)},e.prototype.getContextForElementAndIdentifier=function(e,t){var n=this.modulesByIdentifier.get(t);if(n)return n.contexts.find((function(t){return t.element==e}))},e.prototype.handleError=function(e,t,n){this.application.handleError(e,t,n)},e.prototype.scopeConnected=function(e){this.scopesByIdentifier.add(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.connectContextForScope(e)},e.prototype.scopeDisconnected=function(e){this.scopesByIdentifier.delete(e.identifier,e);var t=this.modulesByIdentifier.get(e.identifier);t&&t.disconnectContextForScope(e)},e.prototype.connectModule=function(e){this.modulesByIdentifier.set(e.identifier,e),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach((function(t){return e.connectContextForScope(t)}))},e.prototype.disconnectModule=function(e){this.modulesByIdentifier.delete(e.identifier),this.scopesByIdentifier.getValuesForKey(e.identifier).forEach((function(t){return e.disconnectContextForScope(t)}))},e}(),K={controllerAttribute:"data-controller",actionAttribute:"data-action",targetAttribute:"data-target"},U=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function c(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(s,c)}a((r=r.apply(e,t||[])).next())}))},H=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};!function(){function e(e,t){void 0===e&&(e=document.documentElement),void 0===t&&(t=K),this.element=e,this.schema=t,this.dispatcher=new f(this),this.router=new D(this)}e.start=function(t,n){var r=new e(t,n);return r.start(),r},e.prototype.start=function(){return U(this,void 0,void 0,(function(){return H(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",e):e()}))];case 1:return e.sent(),this.router.start(),this.dispatcher.start(),[2]}}))}))},e.prototype.stop=function(){this.router.stop(),this.dispatcher.stop()},e.prototype.register=function(e,t){this.load({identifier:e,controllerConstructor:t})},e.prototype.load=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=Array.isArray(e)?e:[e].concat(n);i.forEach((function(e){return t.router.loadDefinition(e)}))},e.prototype.unload=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=Array.isArray(e)?e:[e].concat(n);i.forEach((function(e){return t.router.unloadIdentifier(e)}))},Object.defineProperty(e.prototype,"controllers",{get:function(){return this.router.contexts.map((function(e){return e.controller}))},enumerable:!0,configurable:!0}),e.prototype.getControllerForElementAndIdentifier=function(e,t){var n=this.router.getContextForElementAndIdentifier(e,t);return n?n.controller:null},e.prototype.handleError=function(e,t,n){console.error("%s\n\n%o\n\n%o",t,e,n)}}();function q(e){var t=e.prototype;(function(e){var t=function(e){var t=[];for(;e;)t.push(e),e=Object.getPrototypeOf(e);return t}(e);return Array.from(t.reduce((function(e,t){return function(e){var t=e.targets;return Array.isArray(t)?t:[]}(t).forEach((function(t){return e.add(t)})),e}),new Set))})(e).forEach((function(e){var n,r,i;return r=t,(n={})[e+"Target"]={get:function(){var t=this.targets.find(e);if(t)return t;throw new Error('Missing target element "'+this.identifier+"."+e+'"')}},n[e+"Targets"]={get:function(){return this.targets.findAll(e)}},n["has"+function(e){return e.charAt(0).toUpperCase()+e.slice(1)}(e)+"Target"]={get:function(){return this.targets.has(e)}},i=n,void Object.keys(i).forEach((function(e){if(!(e in r)){var t=i[e];Object.defineProperty(r,e,t)}}))}))}var z=function(){function e(e){this.context=e}return e.bless=function(){q(this)},Object.defineProperty(e.prototype,"application",{get:function(){return this.context.application},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scope",{get:function(){return this.context.scope},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this.scope.element},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this.scope.identifier},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targets",{get:function(){return this.scope.targets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this.scope.data},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){},e.prototype.connect=function(){},e.prototype.disconnect=function(){},e.targets=[],e}(),W=function(e){i(o,z);var n=a(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"connect",value:function(){var e=this;this.show=this._show.bind(this),this.hide=this._hide.bind(this),this.showEventNames.forEach((function(t){document.addEventListener(t,e.show)})),this.hideEventNames.forEach((function(t){return document.addEventListener(t,e.hide)}))}},{key:"disconnect",value:function(){var e=this;this.showEventNames.forEach((function(t){return document.removeEventListener(t,e.show)})),this.hideEventNames.forEach((function(t){return document.removeEventListener(t,e.hide)}))}},{key:"_show",value:function(){this.element.hidden=!1}},{key:"_hide",value:function(){this.element.hidden=!0}},{key:"showEventNames",get:function(){return this.data.get("showEvent").split(" ")}},{key:"hideEventNames",get:function(){return this.data.get("hideEvent").split(" ")}}]),o}(),X=function(e){i(o,z);var n=a(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"connect",value:function(){if(this.autosuggestController=this.element.autosuggestController,this.containerController=this.element.containerController,this.element.controller=this,this.element.setAttribute("class",this.cssClass),this.element.classList.add(this.identifier),this.element.href="#",this.text.length){var e=document.createElement("span");e.setAttribute("class",this.textCssClass),e.classList.add("text"),e.innerText=this.text,this.element.appendChild(e)}if(this.value.length){var t=document.createElement("span");t.setAttribute("class",this.valueCssClass),t.classList.add("value"),t.innerText=this.value,this.element.appendChild(t)}}},{key:"value",get:function(){return this.optionElement.value.trim()}},{key:"text",get:function(){return this.optionElement.innerText.trim()}},{key:"normalizedValue",get:function(){return"".concat(this.text," ").concat(this.value).toLowerCase()}},{key:"optionElement",get:function(){return this.element.optionElement}},{key:"cssClass",get:function(){return this.element.autosuggestController.data.get("optionClass")}},{key:"activeCssClass",get:function(){return this.element.autosuggestController.data.get("optionActiveClass")}},{key:"textCssClass",get:function(){return this.autosuggestController.data.get("optionTextClass")}},{key:"valueCssClass",get:function(){return this.autosuggestController.data.get("optionValueClass")}}]),o}(),G=function(e){i(o,z);var n=a(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"connect",value:function(){var e=this;this.activeIndex=-1,this.element.controller=this,this.element.setAttribute("class",this.cssClass),this.element.classList.add(this.identifier),this.element.style.position="absolute",this.element.style.minHeight="100px",this.element.style.overflowY="scroll",this.element.style.overflowX="hidden",this.element.hidden=!0,this.datalistElement.querySelectorAll("option").forEach((function(t){var n=document.createElement("a");n.autosuggestController=e.autosuggestController,n.containerController=e,n.optionElement=t,n.setAttribute("data-controller","hopsoft-autosuggest-anchor"),e.element.appendChild(n)}),this)}},{key:"show",value:function(){var e=this.autosuggestController.layout;this.element.style.minWidth="".concat(e.width,"px"),this.element.style.left="".concat(e.left,"px"),this.element.style.top="".concat(e.top+e.height,"px"),this.element.hidden=!1}},{key:"hide",value:function(){this.element.hidden=!0}},{key:"filter",value:function(e){e=e.toLowerCase().trim(),this.activeIndex=-1,this.anchorElements.forEach((function(t){t.controller.normalizedValue.includes(e)?t.style.removeProperty("display"):t.style.display="none"}))}},{key:"find",value:function(e){return this.anchorElements.find((function(t){return t.controller.value===e}))}},{key:"highlight",value:function(){this.anchorElements.forEach((function(e){return e.classList.remove(e.controller.activeCssClass)})),this.activeAnchorElement.classList.add(this.activeAnchorElement.controller.activeCssClass),this.activeAnchorElement.scrollIntoView({behavior:"smooth",block:"end",inline:"end"})}},{key:"highlightNext",value:function(){this.activeIndex++,this.activeIndex>this.visibleAnchorElements.length-1&&(this.activeIndex=0),this.highlight()}},{key:"highlightPrevious",value:function(){this.activeIndex--,this.activeIndex<0&&(this.activeIndex=this.visibleAnchorElements.length-1),this.highlight()}},{key:"reset",value:function(){this.anchorElements.forEach((function(e){return e.style.removeProperty("display")}))}},{key:"anchorElements",get:function(){return Array.from(this.element.querySelectorAll("a"))}},{key:"visibleAnchorElements",get:function(){return this.anchorElements.filter((function(e){return"none"!==e.style.display}))}},{key:"activeAnchorElement",get:function(){return this.visibleAnchorElements[this.activeIndex]}},{key:"autosuggestController",get:function(){return this.element.autosuggestController}},{key:"datalistElement",get:function(){return this.autosuggestController.datalistElement}},{key:"cssClass",get:function(){return this.autosuggestController.data.get("containerClass")}}]),o}(),$=function(e){i(o,z);var n=a(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"connect",value:function(){document.dispatchEvent(new CustomEvent("hopsoft:autosuggest:connect",{detail:{controller:this}})),this.element.controller=this,this.element.setAttribute("data-action",this.actions.join(" ")),this.datalistElement=this.element.list,this.element.removeAttribute("list"),this.containerElement=document.createElement("div"),this.containerElement.autosuggestController=this,this.containerElement.setAttribute("data-controller","hopsoft-autosuggest-container"),document.body.appendChild(this.containerElement)}},{key:"focus",value:function(){this.containerElement.controller.reset(),this.containerElement.controller.show()}},{key:"blur",value:function(e){var t=this;setTimeout((function(){return t.containerElement.controller.hide()}),25)}},{key:"keydown",value:function(e){switch(e.key){case"Escape":this.blur();break;case"ArrowDown":this.containerElement.controller.highlightNext();break;case"ArrowUp":this.containerElement.controller.highlightPrevious();break;case"Enter":e.preventDefault(),this.element.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,code:"Tab",key:"Tab",keyIdentifier:"Tab",keyCode:9,which:9}));break;case"Tab":var t=this.containerElement.controller.activeAnchorElement;if(t){var n=this.values;n.pop(),this.values=[].concat(u(n),[t.controller.value])}break;case"Backspace":""===this.value?(this.value="",this.containerElement.controller.reset()):this.containerElement.controller.find(this.lastValue)&&(e.preventDefault(),this.values=this.values.slice(0,-1))}}},{key:"input",value:function(e){this.focus(),this.value.length&&this.containerElement.controller.filter(this.values.pop())}},{key:"click",value:function(e){var t=e.target.closest('[data-controller="hopsoft-autosuggest-anchor"]');t&&(this.values=[].concat(u(this.values),[t.controller.value]))}},{key:"value",get:function(){return this.element.value.trim()},set:function(e){return this.element.value=e.trim()}},{key:"values",get:function(){return this.element.value.split(",").map((function(e){return e.trim()}))},set:function(e){if(this.element.multiple)return this.value=e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join(",");this.value=e.pop()}},{key:"lastValue",get:function(){return this.values.pop()}},{key:"actions",get:function(){var e=new Set((this.element.dataset.action||"").split(" "));return e.add("blur->".concat(this.identifier,"#blur")),e.add("focus->".concat(this.identifier,"#focus")),e.add("input->".concat(this.identifier,"#input")),e.add("keydown->".concat(this.identifier,"#keydown")),e.add("click@document->".concat(this.identifier,"#click")),Array.from(e).filter((function(e){return e.length}))}},{key:"layout",get:function(){return this.element.getBoundingClientRect()}}]),o}();function Y(e,t,n){if(!e.controllers.find((function(e){return e.identifier===t})))return e.register(t,n)}document.addEventListener("hopsoft:autosuggest:connect",(function(e){var t=e.detail.controller.application;Y(t,"hopsoft-autosuggest-anchor",X),Y(t,"hopsoft-autosuggest-container",G)}));var Z,J,Q,ee=function(e){i(o,z);var n=a(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"copy",value:function(e){e.preventDefault(),this.value=this.sourceTarget.value||this.sourceTarget.innerHTML,this.value.length&&(this.disable&&this._toggleDisabled(),this._doCopy())}},{key:"showCopied",value:function(){var e=this,t=this.triggerTarget.innerHTML;this.content!==t&&0!==this.duration?(this.triggerTarget.innerHTML=this.content,setTimeout((function(){e.triggerTarget.innerHTML=t,e.disable&&e._toggleDisabled()}),this.duration)):this.disable&&this._toggleDisabled()}},{key:"_doCopy",value:function(){var e;this.sourceTarget.value?this.sourceTarget.select():((e=document.createRange()).selectNode(this.sourceTarget),window.getSelection().empty(),window.getSelection().addRange(e)),document.execCommand("copy"),this.showCopied(),this.sourceTarget.value?(this.sourceTarget.value="",this.sourceTarget.value=this.value,this.sourceTarget.focus()):window.getSelection().removeAllRanges()}},{key:"_toggleDisabled",value:function(){this.triggerTarget.toggleAttribute("disabled",!this.triggerTarget.disabled)}},{key:"content",get:function(){return this.data.get("content")||"Copied..."}},{key:"duration",get:function(){return Number(this.data.get("duration")||2e3)}},{key:"disable",get:function(){return this.data.has("disable")}}]),o}();Q=["source","trigger"],(J="targets")in(Z=ee)?Object.defineProperty(Z,J,{value:Q,enumerable:!0,configurable:!0,writable:!0}):Z[J]=Q;var te=function(n){i(u,z);var o,s,c=a(u);function u(){return t(this,u),c.apply(this,arguments)}return r(u,[{key:"dismiss",value:(o=regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault();try{this.data.has("url")&&fetch(this.url,{method:this.method,credentials:"same-origin",body:this.body})}catch(e){}finally{this.element.classList.add(this.invisibleClass),setTimeout((function(){n.element.remove()}),this.duration)}case 2:case"end":return e.stop()}}),e,this)})),s=function(){var t=this,n=arguments;return new Promise((function(r,i){var s=o.apply(t,n);function c(t){e(s,r,i,c,a,"next",t)}function a(t){e(s,r,i,c,a,"throw",t)}c(void 0)}))},function(e){return s.apply(this,arguments)})},{key:"duration",get:function(){return this.data.get("duration")||200}},{key:"invisibleClass",get:function(){return this.data.get("invisibleClass")||"hidden"}},{key:"url",get:function(){return this.data.get("url")}},{key:"method",get:function(){return this.data.get("method")||"PUT"}},{key:"body",get:function(){return this.data.get("body")||""}}]),u}(),ne={},re=document.implementation.createHTMLDocument("@hopsoft/prefetch-turbolinks-controller");function ie(e){!function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.setRequestHeader("VND.PREFETCH","true"),n.setRequestHeader("Accept","text/html"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&200===n.status&&t(n.responseText)},n.send()}(e,(function(t){re.open(),re.write(t),re.close();var n=Turbolinks.Snapshot.fromHTMLElement(re.documentElement);Turbolinks.controller.cache.put(e,n)}))}var oe=function(e){i(o,z);var n=a(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"prefetch",value:function(){var e=this;this.prefetched||this.prefetching||(ne[this.url]=setTimeout(function(){return ie(e.url)}.bind(this),this.hoverTime))}},{key:"cleanup",value:function(){clearTimeout(ne[this.url]),ne[this.url]=null}},{key:"url",get:function(){return this.element.getAttribute("href")}},{key:"prefetching",get:function(){return!!ne[this.url]}},{key:"prefetched",get:function(){return location.href===this.url||Turbolinks.controller.cache.has(this.url)}},{key:"hoverTime",get:function(){return Number(this.data.get("hoverTime")||400)}}]),o}();export{W as ActivityController,$ as AutosuggestController,ee as CopyController,te as DismissibleController,oe as PrefetchTurbolinksController};
